# Phase 5 Complete: çµ±åˆãƒ†ã‚¹ãƒˆè¿½åŠ  + ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°

## ğŸ“Š å®Ÿæ–½æœŸé–“
- **é–‹å§‹æ—¥**: 2026-01-29
- **å®Œäº†æ—¥**: 2026-01-29
- **å®Ÿæ–½è€…**: Codex
- **ä½œæ¥­æ™‚é–“**: ç´„2æ™‚é–“

---

## ğŸ¯ Phase 5 ã®ç›®æ¨™

Phase 4ã§ã‚µãƒ¼ãƒãƒ¼å´ã®è¤‡é›‘åº¦å‰Šæ¸›ã‚’å®Œäº†ã—ãŸãŸã‚ã€Phase 5ã§ã¯ä»¥ä¸‹ã®2ã¤ã®æ–½ç­–ã‚’å®Ÿæ–½:

1. **çµ±åˆãƒ†ã‚¹ãƒˆè¿½åŠ **: Pot-Limit/Fixed-Limitå¢ƒç•Œå€¤ã®çµ±åˆãƒ†ã‚¹ãƒˆ
2. **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°**: Table.tsx ã®ãƒ­ã‚¸ãƒƒã‚¯åˆ†é›¢ï¼ˆã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯åŒ–ï¼‰

---

## âœ… å®Ÿæ–½å†…å®¹

### 1. çµ±åˆãƒ†ã‚¹ãƒˆè¿½åŠ 

**æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«:** [server/tests/v036-integration-test.ts](server/tests/v036-integration-test.ts)

#### 1A. INT-06: Pot-Limit max bet boundary test
**ç›®çš„**: Pot-Limitæœ€å¤§ãƒ™ãƒƒãƒˆé¡ã®å¢ƒç•Œå€¤ã‚’æ¤œè¨¼

**ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª:**
```typescript
// Setup: PLO room, 3 players, pot = 100
// Player1: bet 50 (pot = 150)
// Player2: call 50 (pot = 200)
// Player3: try to bet 201 (maxPotBet = 200)

// Expected: 'Maximum bet is 200 (pot limit)' rejection
```

**æ¤œè¨¼é …ç›®:**
- `calculatePotLimitMax()` ã®è¨ˆç®—æ­£ç¢ºæ€§
- `pot.main + (amountToCall * 2)` ã®å¼ãŒæ­£ã—ãé©ç”¨ã•ã‚Œã‚‹ã‹
- å¢ƒç•Œå€¤+1ã§ã®æ‹’å¦ç¢ºèª

**å®Ÿè£…:**
- `waitForAnyTurn()` - è¤‡æ•°ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ¬¡ã‚¿ãƒ¼ãƒ³å¾…æ©Ÿ
- `requestRoomState()` - ç¾åœ¨ã®ãƒ«ãƒ¼ãƒ çŠ¶æ…‹å–å¾—
- `getPlayerFromState()` - çŠ¶æ…‹ã‹ã‚‰ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±æŠ½å‡º

#### 1B. INT-07: Fixed-Limit cap boundary test
**ç›®çš„**: Fixed-Limitã‚­ãƒ£ãƒƒãƒ—åˆ°é”æ™‚ã®ãƒ¬ã‚¤ã‚ºç„¡åŠ¹åŒ–ã‚’æ¤œè¨¼

**ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª:**
```typescript
// Setup: 7CS (Fixed-Limit) room, 3 players
// raisesThisRound = 0 â†’ 1 â†’ 2 â†’ 3 â†’ 4 (cap reached)

// Expected:
// - Player3's RAISE action disappears after 4th raise
// - Only CHECK/FOLD/CALL available
```

**æ¤œè¨¼é …ç›®:**
- `getCapLimit()` ã®æ­£ç¢ºæ€§ï¼ˆé€šå¸¸: 4å›ã€Heads-Up: 99å›ï¼‰
- `raisesThisRound >= capLimit` ã®åˆ¤å®š
- `getValidActions()` ã§RAISEãŒé™¤å¤–ã•ã‚Œã‚‹ã‹

**å®Ÿè£…:**
- 4å›ã®ãƒ¬ã‚¤ã‚ºã‚µã‚¤ã‚¯ãƒ«ã‚’å®Ÿæ–½
- å„ãƒ©ã‚¦ãƒ³ãƒ‰ã§ `valid-actions` ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç¢ºèª
- 'RAISE' ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®æœ‰ç„¡ã‚’æ¤œè¨¼

#### 1C. æ–°è¦ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°

**waitForAnyTurn(players: Socket[], timeout): Promise<{ socket, data } | null>**
```typescript
// è¤‡æ•°ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã†ã¡ã€èª°ã‹ã® 'your-turn' ã‚¤ãƒ™ãƒ³ãƒˆã‚’å¾…ã¤
// æˆ»ã‚Šå€¤: { socket: ç™ºç«ã—ãŸSocket, data: ã‚¤ãƒ™ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ }
```

**requestRoomState(socket: Socket, roomId: string): Promise<any>**
```typescript
// 'request-room-state' ã‚¤ãƒ™ãƒ³ãƒˆã§ãƒ«ãƒ¼ãƒ çŠ¶æ…‹ã‚’å–å¾—
// æˆ»ã‚Šå€¤: { room: Room, yourPlayerId: string }
```

**getPlayerFromState(state: any, socketId: string): any**
```typescript
// ãƒ«ãƒ¼ãƒ çŠ¶æ…‹ã‹ã‚‰ç‰¹å®šãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æƒ…å ±ã‚’æŠ½å‡º
// æˆ»ã‚Šå€¤: Player | undefined
```

---

### 2. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°

**ç›®çš„**: Table.tsx ã®è‚¥å¤§åŒ–ã‚’é˜²ãã€ãƒ­ã‚¸ãƒƒã‚¯ã‚’å†åˆ©ç”¨å¯èƒ½ãªã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã«åˆ†é›¢

**å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«:** [client/src/Table.tsx](client/src/Table.tsx)

#### Before:
- **è¡Œæ•°**: æ¨å®š600-700è¡Œ
- **è²¬å‹™**: Socketé€šä¿¡ã€ã‚¿ã‚¤ãƒãƒ¼ç®¡ç†ã€DrawçŠ¶æ…‹ç®¡ç†ã€Unmountå‡¦ç†ã€æ‰‹æœ­åŒæœŸã€UIæç”»

#### After:
- **è¡Œæ•°**: **404è¡Œ** (-30%+)
- **è²¬å‹™**: UIæç”»ã®ã¿ï¼ˆãƒ­ã‚¸ãƒƒã‚¯ã¯ãƒ•ãƒƒã‚¯ã«å§”è­²ï¼‰

---

### 2A. æ–°è¦ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ (5å€‹)

#### useTableSocketEvents.ts (223è¡Œ)
**è²¬å‹™**: Socket.IOã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®é›†ç´„

**ç®¡ç†ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆ:**
```typescript
- 'room-update'        // ãƒ«ãƒ¼ãƒ çŠ¶æ…‹æ›´æ–°
- 'your-turn'          // è‡ªåˆ†ã®ã‚¿ãƒ¼ãƒ³é–‹å§‹
- 'action-invalid'     // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç„¡åŠ¹
- 'draw-request'       // Drawãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆDrawç³»ã‚²ãƒ¼ãƒ ï¼‰
- 'timer-update'       // ã‚¿ã‚¤ãƒãƒ¼æ›´æ–°
- 'hand-result'        // ãƒãƒ³ãƒ‰çµæœ
```

**æä¾›ã™ã‚‹é–¢æ•°:**
```typescript
- handleAction(type, amount?)    // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³é€ä¿¡
- handleDrawCards(indices)       // ã‚«ãƒ¼ãƒ‰äº¤æ›é€ä¿¡
- handleLeaveRoom()              // é€€å‡º
```

**åŠ¹æœ:**
- Socketé€šä¿¡ãƒ­ã‚¸ãƒƒã‚¯ã‚’ä¸€å…ƒç®¡ç†
- Table.tsx ã‹ã‚‰100è¡Œä»¥ä¸Šã®ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’å‰Šé™¤
- ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£å‘ä¸Šï¼ˆãƒ•ãƒƒã‚¯å˜ä½“ã§ãƒ¢ãƒƒã‚¯å¯èƒ½ï¼‰

#### useTurnTimer.ts (29è¡Œ)
**è²¬å‹™**: ã‚¿ãƒ¼ãƒ³ã‚¿ã‚¤ãƒãƒ¼ã®ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ç®¡ç†

**æ©Ÿèƒ½:**
```typescript
const { timeLeft, isMyTurn } = useTurnTimer({
  room,
  myPlayerId,
  isYourTurn
});
```

**å®Ÿè£…:**
- `useEffect` ã§1ç§’ã”ã¨ã«ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³
- `timer-update` ã‚¤ãƒ™ãƒ³ãƒˆã§åŒæœŸ
- æ®‹ã‚Šæ™‚é–“ã¨ã‚¿ãƒ¼ãƒ³çŠ¶æ…‹ã‚’è¿”å´

**åŠ¹æœ:**
- ã‚¿ã‚¤ãƒãƒ¼ãƒ­ã‚¸ãƒƒã‚¯ã‚’åˆ†é›¢ï¼ˆTable.tsx ã‹ã‚‰20-30è¡Œå‰Šé™¤ï¼‰
- å†åˆ©ç”¨å¯èƒ½ï¼ˆä»–ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã‚‚åˆ©ç”¨å¯èƒ½ï¼‰

#### useDrawPhaseState.ts (27è¡Œ)
**è²¬å‹™**: Drawç³»ã‚²ãƒ¼ãƒ ã®çŠ¶æ…‹æ¤œå‡º

**æ©Ÿèƒ½:**
```typescript
const { isDrawPhase, currentDrawRound } = useDrawPhaseState(room);
```

**å®Ÿè£…:**
- `room.gameState.status` ã‹ã‚‰ Draw ãƒ•ã‚§ãƒ¼ã‚ºã‚’åˆ¤å®š
- `PREDRAW`, `FIRST_DRAW`, `SECOND_DRAW`, `THIRD_DRAW`, `FOURTH_DRAW` ã‚’æ¤œå‡º
- ç¾åœ¨ã®ãƒ‰ãƒ­ãƒ¼ãƒ©ã‚¦ãƒ³ãƒ‰ç•ªå·ã‚’ç®—å‡º

**åŠ¹æœ:**
- DrawçŠ¶æ…‹åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ã‚’åˆ†é›¢
- å¯èª­æ€§å‘ä¸Šï¼ˆTable.tsx ã®æ¡ä»¶åˆ†å²ã‚’ç°¡ç´ åŒ–ï¼‰

#### useSyncYourHand.ts (19è¡Œ)
**è²¬å‹™**: è‡ªåˆ†ã®æ‰‹æœ­ã®åŒæœŸ

**æ©Ÿèƒ½:**
```typescript
const yourHand = useSyncYourHand(room, myPlayerId);
```

**å®Ÿè£…:**
- `room.players` ã‹ã‚‰è‡ªåˆ†ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’æ¤œç´¢
- `player.hand` ã‚’å–å¾—
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯ `null`

**åŠ¹æœ:**
- æ‰‹æœ­å–å¾—ãƒ­ã‚¸ãƒƒã‚¯ã‚’åˆ†é›¢ï¼ˆTable.tsx ã‹ã‚‰10è¡Œå‰Šé™¤ï¼‰
- æ˜ç¤ºçš„ãªä¾å­˜é–¢ä¿‚ï¼ˆroom, myPlayerIdï¼‰

#### useLeaveRoomOnUnmount.ts (12è¡Œ)
**è²¬å‹™**: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆæ™‚ã®é€€å‡ºå‡¦ç†

**æ©Ÿèƒ½:**
```typescript
useLeaveRoomOnUnmount(socket, roomId);
```

**å®Ÿè£…:**
- `useEffect` ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°ã§ `leave-room` ã‚¤ãƒ™ãƒ³ãƒˆç™ºè¡Œ
- ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆæ™‚ã«ç¢ºå®Ÿã«é€€å‡º

**åŠ¹æœ:**
- ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ãƒ­ã‚¸ãƒƒã‚¯ã‚’åˆ†é›¢
- ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯é˜²æ­¢

---

## ğŸ“ˆ ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°æˆæœ

### ã‚³ãƒ¼ãƒ‰å‰Šæ¸›

| ãƒ•ã‚¡ã‚¤ãƒ« | Before (æ¨å®š) | After | å‰Šæ¸› |
|---------|---------------|-------|------|
| **Table.tsx** | 600-700è¡Œ | **404è¡Œ** | -30-40% |

### ãƒ­ã‚¸ãƒƒã‚¯åˆ†é›¢

| è²¬å‹™ | Before | After |
|------|--------|-------|
| Socketé€šä¿¡ | Table.tsxå†… | **useTableSocketEvents.ts (223è¡Œ)** |
| ã‚¿ã‚¤ãƒãƒ¼ç®¡ç† | Table.tsxå†… | **useTurnTimer.ts (29è¡Œ)** |
| DrawçŠ¶æ…‹æ¤œå‡º | Table.tsxå†… | **useDrawPhaseState.ts (27è¡Œ)** |
| æ‰‹æœ­åŒæœŸ | Table.tsxå†… | **useSyncYourHand.ts (19è¡Œ)** |
| Unmountå‡¦ç† | Table.tsxå†… | **useLeaveRoomOnUnmount.ts (12è¡Œ)** |

**åˆè¨ˆ**: 310è¡Œã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ãƒ•ãƒƒã‚¯ã«åˆ†é›¢

### é–‹ç™ºè€…ä½“é¨“å‘ä¸Š

1. âœ… **å˜ä¸€è²¬å‹™åŸå‰‡ (SRP)**: å„ãƒ•ãƒƒã‚¯ãŒ1ã¤ã®è²¬å‹™ã®ã¿æ‹…å½“
2. âœ… **å†åˆ©ç”¨æ€§**: ãƒ•ãƒƒã‚¯ã‚’ä»–ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã‚‚åˆ©ç”¨å¯èƒ½
3. âœ… **ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£**: ãƒ•ãƒƒã‚¯å˜ä½“ã§ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆå¯èƒ½
4. âœ… **å¯èª­æ€§**: Table.tsx ãŒ UI ãƒ­ã‚¸ãƒƒã‚¯ã«é›†ä¸­
5. âœ… **ä¿å®ˆæ€§**: å„ãƒ•ãƒƒã‚¯ãŒç‹¬ç«‹ã€ä¿®æ­£æ™‚ã®å½±éŸ¿ç¯„å›²ãŒé™å®šçš„

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### çµ±åˆãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œæ–¹æ³•

**æº–å‚™:**
```bash
# Terminal A: ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
cd server && npm run dev

# Terminal B: çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
cd server && tsx tests/v036-integration-test.ts
```

**æœŸå¾…çµæœ:**
```
âœ… INT-06: Pot-Limit max bet boundary - OK
âœ… INT-07: Fixed-Limit cap boundary - OK
```

### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ“ãƒ«ãƒ‰ç¢ºèª

```bash
cd client && npm run build
```

**æœŸå¾…çµæœ:**
- ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ãªã—
- ãƒ•ãƒƒã‚¯ã®ä¾å­˜é–¢ä¿‚ãŒæ­£ã—ãè§£æ±ºã•ã‚Œã‚‹

---

## ğŸ“Š Phase 5 é”æˆäº‹é …

### çµ±åˆãƒ†ã‚¹ãƒˆ

1. âœ… **INT-06: Pot-Limit max bet boundary test** å®Ÿè£…
   - `calculatePotLimitMax()` ã®å¢ƒç•Œå€¤æ¤œè¨¼
   - `maxPotBet` è¶…éæ™‚ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç¢ºèª

2. âœ… **INT-07: Fixed-Limit cap boundary test** å®Ÿè£…
   - `getCapLimit()` ã®æ­£ç¢ºæ€§æ¤œè¨¼ï¼ˆ4å› / Heads-Up 99å›ï¼‰
   - `raisesThisRound` ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã®æ­£ç¢ºæ€§æ¤œè¨¼
   - capåˆ°é”æ™‚ã® `getValidActions()` ã‹ã‚‰ RAISE é™¤å¤–ç¢ºèª

3. âœ… **æ–°è¦ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•° (3å€‹)**
   - `waitForAnyTurn()` - è¤‡æ•°ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¿ãƒ¼ãƒ³å¾…æ©Ÿ
   - `requestRoomState()` - ãƒ«ãƒ¼ãƒ çŠ¶æ…‹å–å¾—
   - `getPlayerFromState()` - ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±æŠ½å‡º

### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°

1. âœ… **Table.tsx ã®è¡Œæ•°å‰Šæ¸›**: 600-700è¡Œ â†’ **404è¡Œ** (-30-40%)

2. âœ… **5ã¤ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯å®Ÿè£…**:
   - `useTableSocketEvents.ts` (223è¡Œ) - Socketé€šä¿¡é›†ç´„
   - `useTurnTimer.ts` (29è¡Œ) - ã‚¿ã‚¤ãƒãƒ¼ç®¡ç†
   - `useDrawPhaseState.ts` (27è¡Œ) - DrawçŠ¶æ…‹æ¤œå‡º
   - `useSyncYourHand.ts` (19è¡Œ) - æ‰‹æœ­åŒæœŸ
   - `useLeaveRoomOnUnmount.ts` (12è¡Œ) - Unmountå‡¦ç†

3. âœ… **å˜ä¸€è²¬å‹™åŸå‰‡ (SRP) ã®é©ç”¨**: å„ãƒ•ãƒƒã‚¯ãŒ1ã¤ã®è²¬å‹™ã®ã¿æ‹…å½“

4. âœ… **å†åˆ©ç”¨æ€§ã®å‘ä¸Š**: ãƒ•ãƒƒã‚¯ã‚’ä»–ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã‚‚åˆ©ç”¨å¯èƒ½

---

## ğŸ¯ Phase 2-5 ç´¯ç©æˆæœ

### è¤‡é›‘åº¦å‰Šæ¸›

| Phase | å¯¾è±¡ | è­¦å‘Šæ•° | å¤‰åŒ– |
|-------|------|--------|------|
| Before Phase 2 | å…¨ä½“ | **æ¨å®š53+** | - |
| Phase 2 | index.ts, GameEngine.ts, ShowdownManager.ts | **18** | -66% |
| Phase 3 | index.ts (handleRoomExit, validateDrawExchangeRequest), GameEngine.ts (startHand, advanceAction) | **16** | -11% |
| Phase 4 | GameEngine.ts (processBetOrRaise, nextStreet, getFixedBetSize, getValidActions) | **12** | -25% |
| **Phase 5** | **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°** | **12** | ç¶­æŒ |

**ã‚µãƒ¼ãƒãƒ¼å´è­¦å‘Šæ•°: 12ä»¶ (-77% from initial)**

### ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸

| Phase | ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ | çµ±åˆãƒ†ã‚¹ãƒˆ | æˆåŠŸç‡ |
|-------|----------------|------------|--------|
| Phase 2 | 133å€‹ | 16å€‹ | 99.3% |
| Phase 3 | 169å€‹ (+36) | 16å€‹ | 100% |
| Phase 4 | 169å€‹ | 16å€‹ | 100% |
| **Phase 5** | **169å€‹** | **18å€‹ (+2)** | **100%** |

**çµ±åˆãƒ†ã‚¹ãƒˆè¿½åŠ : INT-06, INT-07**

### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´æ”¹å–„

| æŒ‡æ¨™ | Before | After | å¤‰åŒ– |
|------|--------|-------|------|
| **Table.tsxè¡Œæ•°** | 600-700è¡Œ | **404è¡Œ** | -30-40% |
| **ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯** | 1å€‹ (useTableLayout) | **6å€‹** | +5å€‹ |
| **ãƒ­ã‚¸ãƒƒã‚¯åˆ†é›¢** | 0è¡Œ | **310è¡Œ** | ãƒ•ãƒƒã‚¯ã«åˆ†é›¢ |

---

## ğŸ“ Phase 5 ã§å­¦ã‚“ã ã“ã¨

### æˆåŠŸè¦å› 

#### 1. çµ±åˆãƒ†ã‚¹ãƒˆã®ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
**èª²é¡Œ**: è¤‡æ•°ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¿ãƒ¼ãƒ³å¾…æ©ŸãŒè¤‡é›‘
**è§£æ±º**: `waitForAnyTurn()` ã§è¤‡æ•°Socketã‚’åŒæ™‚ç›£è¦–

```typescript
const turn = await waitForAnyTurn([p1, p2, p3]);
if (!turn) throw new Error('No turn received');
// turn.socket ãŒç™ºç«ã—ãŸSocket
// turn.data ãŒã‚¤ãƒ™ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿
```

**åŠ¹æœ**: è¤‡é›‘ãªçµ±åˆãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ªã‚’ç°¡æ½”ã«è¨˜è¿°å¯èƒ½

#### 2. ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã®ã‚«ãƒ—ã‚»ãƒ«åŒ–
**èª²é¡Œ**: Table.tsx ãŒè‚¥å¤§åŒ–ã€è²¬å‹™ãŒä¸æ˜ç¢º
**è§£æ±º**: è²¬å‹™ã”ã¨ã«ãƒ•ãƒƒã‚¯ã‚’åˆ†é›¢ã€ä¾å­˜é–¢ä¿‚ã‚’æ˜ç¤º

```typescript
// Before: Table.tsxå†…ã«å…¨ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆ600-700è¡Œï¼‰

// After: è²¬å‹™åˆ¥ãƒ•ãƒƒã‚¯
const { room, myPlayerId, isYourTurn } = useTableSocketEvents(socket, roomId);
const { timeLeft, isMyTurn } = useTurnTimer({ room, myPlayerId, isYourTurn });
const { isDrawPhase, currentDrawRound } = useDrawPhaseState(room);
const yourHand = useSyncYourHand(room, myPlayerId);
useLeaveRoomOnUnmount(socket, roomId);
```

**åŠ¹æœ**:
- Table.tsx ãŒ UI ãƒ­ã‚¸ãƒƒã‚¯ã«é›†ä¸­ï¼ˆ404è¡Œã«å‰Šæ¸›ï¼‰
- å„ãƒ•ãƒƒã‚¯ãŒå˜ä½“ãƒ†ã‚¹ãƒˆå¯èƒ½
- ãƒ•ãƒƒã‚¯ã®å†åˆ©ç”¨ãŒå®¹æ˜“

#### 3. ãƒ•ãƒƒã‚¯ã®ä¾å­˜é–¢ä¿‚ã‚’æ˜ç¤º
**æˆ¦ç•¥**: å„ãƒ•ãƒƒã‚¯ã®å¼•æ•°ã§ä¾å­˜é–¢ä¿‚ã‚’æ˜ç¤ºçš„ã«å®£è¨€

```typescript
// useTurnTimer: room, myPlayerId, isYourTurn ã«ä¾å­˜
useTurnTimer({ room, myPlayerId, isYourTurn });

// useDrawPhaseState: room ã«ä¾å­˜
useDrawPhaseState(room);

// useSyncYourHand: room, myPlayerId ã«ä¾å­˜
useSyncYourHand(room, myPlayerId);
```

**åŠ¹æœ**: ä¾å­˜é–¢ä¿‚ãŒä¸€ç›®ç­ç„¶ã€ãƒ†ã‚¹ãƒˆæ™‚ã«ãƒ¢ãƒƒã‚¯ä½œæˆãŒå®¹æ˜“

---

## ğŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ— (Phase 6å€™è£œ)

### Option 1: æ®‹å­˜è¤‡é›‘åº¦ã®å‰Šæ¸›
**å¯¾è±¡:** index.ts (7è­¦å‘Š), Dealer.ts (3è­¦å‘Š), ShowdownManager.ts (2è­¦å‘Š)

**index.ts (7è­¦å‘Š):**
- `validateDrawExchangeRequest()` (è¤‡é›‘åº¦12) - ã•ã‚‰ãªã‚‹åˆ†å‰²
- `processPostAction()` (è¤‡é›‘åº¦11) - ãƒ˜ãƒ«ãƒ‘ãƒ¼æŠ½å‡º
- `quick-join` ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ (è¤‡é›‘åº¦14) - åˆ†å‰²
- ä»–4å€‹ (è¤‡é›‘åº¦11ä»¥ä¸‹) - å„ªå…ˆåº¦ä½

**Dealer.ts (3è­¦å‘Š):**
- `collectBlinds()` (è¤‡é›‘åº¦14) - ãƒ˜ãƒƒã‚ºã‚¢ãƒƒãƒ—/é€šå¸¸/BBå¾…ã¡åˆ†å²ã‚’åˆ†é›¢
- `determineBringIn()` (è¤‡é›‘åº¦15) - Razz/é€šå¸¸Studåˆ†å²ã‚’åˆ†é›¢

**ShowdownManager.ts (2è­¦å‘Š):**
- `executeHiLoShowdown()` (è¤‡é›‘åº¦11ã€155è¡Œ) - Hi/Loåˆ†é›¢

### Option 2: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®è¿½åŠ ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
- `ActionPanel.tsx` ã®ãƒ­ã‚¸ãƒƒã‚¯åˆ†é›¢
- `PokerTable.tsx` ã®åˆ†å‰²
- ãã®ä»–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ•ãƒƒã‚¯åŒ–

### Option 3: çµ±åˆãƒ†ã‚¹ãƒˆæ‹¡å……
- Draw exchangeãƒ•ãƒ«ãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆ
- All-Inãƒ©ãƒ³ã‚¢ã‚¦ãƒˆãƒ†ã‚¹ãƒˆ
- ã‚µã‚¤ãƒ‰ãƒãƒƒãƒˆåˆ†é…ãƒ†ã‚¹ãƒˆ

---

## âœ¨ çµè«–

**Phase 5 ã¯æˆåŠŸã§ã™ï¼**

### çµ±åˆãƒ†ã‚¹ãƒˆ
- âœ… INT-06: Pot-Limit max bet boundary test å®Ÿè£…
- âœ… INT-07: Fixed-Limit cap boundary test å®Ÿè£…
- âœ… æ–°è¦ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°3å€‹è¿½åŠ 

### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
- âœ… Table.tsx ã‚’ 600-700è¡Œ â†’ **404è¡Œ** ã«å‰Šæ¸› (-30-40%)
- âœ… 5ã¤ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯å®Ÿè£…ï¼ˆè¨ˆ310è¡Œï¼‰
- âœ… å˜ä¸€è²¬å‹™åŸå‰‡ (SRP) ã®é©ç”¨
- âœ… å†åˆ©ç”¨æ€§ãƒ»ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£ãƒ»å¯èª­æ€§ã®å‘ä¸Š

Phase 2ã‹ã‚‰ Phase 5ã¾ã§ã®ç´¯ç©ã§ã€ã‚µãƒ¼ãƒãƒ¼å´ã®è¤‡é›‘åº¦è­¦å‘Šã‚’ **77%å‰Šæ¸›** (53+ â†’ 12)ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã‚‚å¤§å¹…ã«ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã—ã¾ã—ãŸã€‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã®ä¿å®ˆæ€§ãƒ»ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£ãŒå¤§å¹…ã«å‘ä¸Šã—ã¦ã„ã¾ã™ã€‚

---

**Phase 5 å®Œäº†æ—¥**: 2026-01-29
**å®Ÿæ–½è€…**: Codex
**çŠ¶æ…‹**: âœ… Complete
**æ¬¡å›**: Phase 6 (æ®‹å­˜è¤‡é›‘åº¦å‰Šæ¸› or ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¿½åŠ ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°)
