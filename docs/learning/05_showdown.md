# 学習ノート 05: ショーダウン（役判定）システムの実装

## 背景
ポーカーの勝敗を決定する「ショーダウン」を実装しました。
手札を比較して最も強い役を持つプレイヤーを勝者とし、ポットを獲得する仕組みです。

## 実装のポイント

### 1. 役判定ロジック (`handEvaluator.ts`)
ポーカーの役を数値化し、比較可能にします。

```typescript
interface HandRank {
  rank: number; // 役の強さ（数値が大きいほど強い）
  name: string; // 役の名前
  highCards: number[]; // タイブレーク用の高位カード
}
```

主な役の判定：
- ストレートフラッシュ: rank 8
- フォーカード: rank 7
- フルハウス: rank 6
- フラッシュ: rank 5 （全て同じスート）
- ストレート: rank 4 （連続する5枚）
- スリーカード: rank 3
- ツーペア: rank 2
- ワンペア: rank 1
- ハイカード: rank 0

### 2. ハンドの比較戦略
`compareHands` 関数で2つの手札を比較：
1. まず役のランク（rank）で比較
2. 同じランクなら、高位カード（highCards）で比較
3. 完全に同じなら引き分け（0を返す）

### 3. サーバー側のショーダウン処理
- 全プレイヤーの手札を評価
- 最も強い役を持つプレイヤーを勝者として決定
- 勝者にポットのチップを配分
- ゲームステートをリセット（新ラウンドの準備）

### 4. クライアント側のUI
- **ショーダウンボタン**: カードを引いた後に表示
- **勝者表示**: 勝者の名前、役名、獲得チップ数
- **勝者の手札表示**: どのカードで勝ったかを可視化
- **New Round ボタン**: 次のラウンドを開始

## 検証手順（手動）

1. ブラウザ2つで2人のプレイヤーとして参加
2. 両プレイヤーがベット・コール
3. 「Deal Cards」で手札を配布
4. 「Showdown」ボタンをクリック
5. 勝者が表示され、ポットのチップを獲得する
6. 「New Round」で次のラウンドを開始

## 学び
- **役判定の抽象化**: 役の強さを数値化することで、比較演算が単純になる。
- **モジュール分離**: 役判定ロジックを別ファイル（`handEvaluator.ts`）に分けることで、テストやメンテナンスが容易になる。
- **ESMインポート**: ts-nodeでESM形式を使う場合、インポート時に `.ts` 拡張子を明記する必要がある。
